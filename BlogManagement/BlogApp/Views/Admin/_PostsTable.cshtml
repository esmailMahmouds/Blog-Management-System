@model IEnumerable<BlogApp.Models.DomainClasses.Post>

@if (!Model.Any())
{
    <div class="alert alert-info text-center">
        <i class="fas fa-info-circle"></i>
        <h5>No posts found</h5>
        <p>There are no posts to display in this category.</p>
    </div>
}
else
{
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Category</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Stats</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var post in Model)
                {
                    <tr>
                        <td>
                            <div class="d-flex flex-column">
                                <span class="fw-bold text-truncate" style="max-width: 200px;" title="@post.Title">
                                    @post.Title
                                </span>
                                <small class="text-muted">
                                    @(post.Content.Length > 50 ? post.Content.Substring(0, 50) + "..." : post.Content)
                                </small>
                            </div>
                        </td>
                        <td>
                            <div class="d-flex align-items-center">
                                <i class="fas fa-user-circle me-2"></i>
                                <span>@post.User.Name</span>
                            </div>
                        </td>
                        <td>
                            <span class="badge bg-secondary">@post.Category.Name</span>
                        </td>
                        <td>
                            @switch (post.Status)
                            {
                                case BlogApp.Enums.PostStatus.Approved:
                                    <span class="badge bg-success">
                                        <i class="fas fa-check"></i> Approved
                                    </span>
                                    break;
                                case BlogApp.Enums.PostStatus.Pending:
                                    <span class="badge bg-warning">
                                        <i class="fas fa-clock"></i> Pending
                                    </span>
                                    break;
                                case BlogApp.Enums.PostStatus.Rejected:
                                    <span class="badge bg-danger">
                                        <i class="fas fa-times"></i> Rejected
                                    </span>
                                    break;
                            }
                        </td>
                        <td>
                            <small class="text-muted">
                                @post.CreateDate.ToString("MMM dd, yyyy")
                                <br>
                                @post.CreateDate.ToString("HH:mm")
                            </small>
                        </td>
                        <td>
                            <div class="d-flex flex-column">
                                <small>
                                    <i class="fas fa-thumbs-up text-primary"></i> @post.LikeCount
                                </small>
                                <small>
                                    <i class="fas fa-star text-warning"></i> @post.AverageRate.ToString("0.0")
                                </small>
                                <small>
                                    <i class="fas fa-comments text-info"></i> @(post.Comments?.Count() ?? 0)
                                </small>
                            </div>
                        </td>
                        <td>
                            <div class="btn-group-vertical btn-group-sm" role="group">
                                <!-- View Button -->
                                <a asp-controller="HomePage" asp-action="ViewPost" asp-route-id="@post.Id" 
                                   class="btn btn-outline-info btn-sm" target="_blank" title="View Post">
                                    <i class="fas fa-eye"></i>
                                </a>
                                
                                @if (post.Status == BlogApp.Enums.PostStatus.Pending)
                                {
                                    <!-- Approve Button -->
                                    <button type="button" class="btn btn-outline-success btn-sm" 
                                            onclick="approvePost(@post.Id)" title="Approve Post">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    
                                    <!-- Reject Button -->
                                    <button type="button" class="btn btn-outline-warning btn-sm" 
                                            onclick="rejectPost(@post.Id)" title="Reject Post">
                                        <i class="fas fa-times"></i>
                                    </button>
                                }
                                else if (post.Status == BlogApp.Enums.PostStatus.Rejected)
                                {
                                    <!-- Approve Button for rejected posts -->
                                    <button type="button" class="btn btn-outline-success btn-sm" 
                                            onclick="approvePost(@post.Id)" title="Approve Post">
                                        <i class="fas fa-check"></i>
                                    </button>
                                }
                                else if (post.Status == BlogApp.Enums.PostStatus.Approved)
                                {
                                    <!-- Reject Button for approved posts -->
                                    <button type="button" class="btn btn-outline-warning btn-sm" 
                                            onclick="rejectPost(@post.Id)" title="Reject Post">
                                        <i class="fas fa-times"></i>
                                    </button>
                                }
                                
                                <!-- Delete Button -->
                                <button type="button" class="btn btn-outline-danger btn-sm" 
                                        onclick="deletePost(@post.Id)" title="Delete Post">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}